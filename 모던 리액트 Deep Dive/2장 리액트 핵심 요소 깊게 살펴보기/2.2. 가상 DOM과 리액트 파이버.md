# 🚀 2.2. 가상 DOM과 리액트 파이버

## 🔎 1. DOM과 브라우저 렌더링 과정

> DOM은 웹 페이지에 대한 인터페이스로, **브라우저가 웹 페이지의 콘텐츠와 구조를 어떻게 보여줄지에 대한 정보를** 담고 있다.

브라우저가 웹 사이트 접근 요청을 받고 화면을 그리는 과정에서 일어나는 일은 아래와 같다.

> 1. 브라우저가 사용자가 요청한 주소를 방문해 HTML 파일을 다운로드한다.
> 2. 브라우저의 렌더링 엔진은 **HTML을 파싱해 DOM 노드로 구성된 트리(DOM)를 만든다.**
> 3. 2번 과정에서 CSS 파일을 만나면 해당 CSS 파일도 다운로드한다.
> 4. 브라우저의 렌더링 엔진은 **CSS 파일을 파싱해 CSS 노드로 구성된 트리(CSSOM)를 만든다.**
> 5. 트리 분석 속도를 조금이라도 빠르게 하기 위해서 브라우저는 2번에서 만든 DOM 노드 중 눈에 보이는 노드만 순회한다.
> 6. 눈에 보이는 노드를 대상으로 해당 노드에 대한 CSSOM 정보를 찾고, 여기서 발견한 CSS 스타일 정보를 해당 DOM 노드에 적용한다.

| CSS 적용 과정            | 설명                                                                                                              |
| ------------------------ | ----------------------------------------------------------------------------------------------------------------- |
| 레이아웃(layout, rellow) | 각 노드가 브라우저 화면의 **어느 좌표에 정확하게 나타나야 하는지 계산하는** 과정 (반드시 페인팅 과정도 함께 거침) |
| 페인팅(painting)         | 레이아웃 단계를 거친 노드에 **색과 같은 실제 유효한 모습을** 그리는 과정                                          |

![](https://jess2.xyz/static/0c389301ba794f3ca7b491572d73971d/13e20/browser4.png)

_**🔥 실제로 HTML, CSS가 렌더링되는 과정 예제 코드**_

> 1. HTML 다운로드와 함께 분석
> 2. 스타일시트가 포함된 link 태그를 발견해 style.css 다운로드
> 3. body 태그 하단의 div는 `width: 100%`이므로 뷰포트로 좌우 100% 너비로 잡음
> 4. 3번 하단의 div는 `width: 50%`, 즉 부모의 50%를 너비로 잡아야 하므로 전체 영역의 50% 너비로 잡음
> 5. 2번에서 다운로드한 CSS에 `id="text"`에 대한 스타일 정보를 결합함
> 6. 화면에 HTML 정보를 그리기 위한 모든 정보가 준비되었으므로 위 정보를 바탕으로 렌더링 수행

```html
#text { background-color: red; color: white; }

<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <title>Hello React!</title>
  </head>
  <body>
    <div style="width: 100%">
      <div id="text" style="width: 50%">Hello world!</div>
    </div>
  </body>
</html>
```

## 🔎 2. 가상 DOM의 탄생 배경

> `가상 DOM`은 웹 페이지가 표시해야 할 **DOM을 일단 메모리에 저장하고,** 리액트가 실제 변경에 대한 준비가 완료됐을 때 실제 브라우저의 DOM에 반영한다. 이렇게 하면 렌더링 과정을 최소화할 수 있고 브라우저와 개발자의 부담을 덜 수 있다.

렌더링 이후 `추가 렌더링 작업`은 하나의 페이지에서 모든 작업이 일어나는 **싱글 페이지 애플리케이션<sup>Single Page Application</sup>에서 더욱 많아진다.** 이 특징 때문에 페이지의 깜빡임 없이 자연스러운 웹 페이지 탐색이 가능하다는 장점이 있지만, 하나의 페이지에서 계속해서 요소의 위치를 재계산해야 하므로 DOM을 관리하는 과정에서 부담해야 할 비용이 커진다. 이러한 문제점을 해결하기 위해 탄생한 것이 바로 `가상 DOM`이다.

## 📄 REFERENCE

모던 리액트 Deep Dive 2장 2절 가상 DOM과 리액트 파이버
